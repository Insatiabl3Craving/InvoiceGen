<Window x:Class="InvoiceGenerator.Views.AppPasswordDialog"
    x:Name="RootWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:InvoiceGenerator.Converters"
        Title="" Width="780" Height="600" MinWidth="640" MinHeight="500"
        WindowStartupLocation="CenterScreen" ResizeMode="CanResize" ShowInTaskbar="True"
    Background="{DynamicResource AppBackground}"
    KeyboardNavigation.TabNavigation="Cycle">
    
    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>

        <!-- Shake Animation for Incorrect Password -->
        <Storyboard x:Key="ShakeStoryboard" Duration="0:0:0.6">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="PasswordContainer" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)">
                <EasingDoubleKeyFrame KeyTime="0:0:0" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.05" Value="-12"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.1" Value="12"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.15" Value="-12"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="12"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.25" Value="-9"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="9"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.35" Value="-6"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.4" Value="6"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.45" Value="-4"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="4"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.55" Value="-2"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.6" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

        <!-- Smooth unlock transition -->
        <Storyboard x:Key="UnlockTransitionStoryboard" Duration="0:0:0.28">
            <DoubleAnimation Storyboard.TargetName="DialogShell" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" To="0.985" Duration="0:0:0.28">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="DialogShell" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" To="0.985" Duration="0:0:0.28">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="DialogShell" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.28">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </Window.Resources>

    <Grid>
        <Border Name="DialogShell" Padding="32" Background="{DynamicResource AppBackground}" Opacity="1" RenderTransformOrigin="0.5,0.5">
            <Border.RenderTransform>
                <ScaleTransform ScaleX="1" ScaleY="1"/>
            </Border.RenderTransform>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="1" MaxWidth="360" MinWidth="300" HorizontalAlignment="Center">
                <!-- Password Input with Show/Hide Toggle -->
                <Grid Name="PasswordContainer" Margin="0,0,0,16">
                    <Grid.RenderTransform>
                        <TranslateTransform X="0"/>
                    </Grid.RenderTransform>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Password Box (initially visible) -->
                    <PasswordBox Name="PasswordBox" Grid.Column="0" Style="{DynamicResource ModernPasswordBoxStyle}" PasswordChanged="PasswordInput_Changed" GotFocus="PasswordInput_FocusChanged" LostFocus="PasswordInput_FocusChanged" TabIndex="0"/>
                    
                    <!-- Password Text Box (hidden by default) -->
                    <TextBox Name="PasswordTextBox" Grid.Column="0" Style="{DynamicResource ModernTextBoxStyle}" Visibility="Collapsed" TextChanged="PasswordInput_Changed" GotFocus="PasswordInput_FocusChanged" LostFocus="PasswordInput_FocusChanged" TabIndex="0"/>

                    <TextBlock Name="PasswordPlaceholder" Grid.Column="0" Margin="14,0,0,0" VerticalAlignment="Center" Foreground="{DynamicResource TextPlaceholder}" FontSize="14" IsHitTestVisible="False" Text="Enter your password"/>
                    
                    <!-- Eye Icon Toggle Button -->
                        <Button Name="TogglePasswordVisibility" Grid.Column="1" Style="{DynamicResource EyeButtonStyle}" Content="ðŸ‘"
                            PreviewMouseLeftButtonDown="RevealPasswordButton_PreviewMouseLeftButtonDown"
                            PreviewMouseLeftButtonUp="RevealPasswordButton_PreviewMouseLeftButtonUp"
                            MouseLeave="RevealPasswordButton_MouseLeave"
                            LostMouseCapture="RevealPasswordButton_LostMouseCapture"
                            PreviewTouchDown="RevealPasswordButton_PreviewTouchDown"
                            PreviewTouchUp="RevealPasswordButton_PreviewTouchUp"
                            IsTabStop="False"
                            ToolTip="Press and hold to reveal password"/>

                        <Button Name="InlineSubmitBtn" Grid.Column="2" Style="{DynamicResource EyeButtonStyle}" Content="âžœ"
                            Click="ContinueBtn_Click"
                            IsDefault="True"
                            TabIndex="1"
                            ToolTip="{Binding SubmitTooltip}"/>
                </Grid>

                <TextBlock Name="VerifyErrorText" Visibility="{Binding HasError, Converter={StaticResource BoolToVisibility}}" Foreground="{DynamicResource ErrorRed}" FontSize="12" Margin="0,-10,0,12" TextWrapping="Wrap" Text="{Binding ErrorMessage}"/>

                <!-- Confirm Password Panel (for setup mode) -->
                <StackPanel Name="ConfirmPanel" Visibility="{Binding IsConfirmPanelVisible, Converter={StaticResource BoolToVisibility}}" Margin="0,0,0,16">
                    <TextBlock Text="Confirm Password:" Foreground="{DynamicResource TextPrimary}" FontSize="12" Margin="0,0,0,6" FontWeight="SemiBold"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <PasswordBox Name="ConfirmPasswordBox" Grid.Column="0" Style="{DynamicResource ModernPasswordBoxStyle}" TabIndex="10"/>
                        <Button Name="ToggleConfirmVisibility" Grid.Column="1" Style="{DynamicResource EyeButtonStyle}" Content="ðŸ‘"
                            PreviewMouseLeftButtonDown="RevealConfirmButton_PreviewMouseLeftButtonDown"
                            PreviewMouseLeftButtonUp="RevealConfirmButton_PreviewMouseLeftButtonUp"
                            MouseLeave="RevealConfirmButton_MouseLeave"
                            LostMouseCapture="RevealConfirmButton_LostMouseCapture"
                            PreviewTouchDown="RevealConfirmButton_PreviewTouchDown"
                            PreviewTouchUp="RevealConfirmButton_PreviewTouchUp"
                            IsTabStop="False"
                            ToolTip="Press and hold to reveal password"/>
                    </Grid>
                    <TextBox Name="ConfirmPasswordTextBox" Style="{DynamicResource ModernTextBoxStyle}" Visibility="Collapsed" Margin="0,0,0,0" TabIndex="10"/>
                </StackPanel>

                <TextBlock Name="HintText" Foreground="{DynamicResource TextMuted}" FontSize="12" Margin="0,0,0,24" Text="{Binding HintText}"/>

                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
