<Window x:Class="InvoiceGenerator.Views.AppPasswordDialog"
    x:Name="RootWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="App Password" Width="780" Height="600" MinWidth="640" MinHeight="500"
        WindowStartupLocation="CenterScreen" ResizeMode="CanResize" ShowInTaskbar="True"
    Background="#FAFAFA"
    KeyboardNavigation.TabNavigation="Cycle">
    
    <Window.Resources>
        <!-- Shake Animation for Incorrect Password -->
        <Storyboard x:Key="ShakeStoryboard" Duration="0:0:0.6">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="PasswordContainer" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)">
                <EasingDoubleKeyFrame KeyTime="0:0:0" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.05" Value="-12"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.1" Value="12"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.15" Value="-12"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="12"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.25" Value="-9"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="9"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.35" Value="-6"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.4" Value="6"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.45" Value="-4"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="4"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.55" Value="-2"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.6" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

        <!-- Smooth unlock transition -->
        <Storyboard x:Key="UnlockTransitionStoryboard" Duration="0:0:0.28">
            <DoubleAnimation Storyboard.TargetName="DialogShell" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)" To="0.985" Duration="0:0:0.28">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="DialogShell" Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)" To="0.985" Duration="0:0:0.28">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="DialogShell" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.28">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Style for Text Inputs -->
        <Style x:Key="ModernTextBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#1A1A1A"/>
            <Setter Property="BorderBrush" Value="#D3D3D3"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" SnapsToDevicePixels="True" CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="False" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter Property="BorderBrush" TargetName="border" Value="#007ACC"/>
                                <Setter Property="BorderThickness" TargetName="border" Value="2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernPasswordBoxStyle" TargetType="PasswordBox">
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#1A1A1A"/>
            <Setter Property="BorderBrush" Value="#D3D3D3"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="PasswordBox">
                        <Border x:Name="border" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" SnapsToDevicePixels="True" CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="False" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter Property="BorderBrush" TargetName="border" Value="#007ACC"/>
                                <Setter Property="BorderThickness" TargetName="border" Value="2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style for Reveal Button (Eye Icon) -->
        <Style x:Key="EyeButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="42"/>
            <Setter Property="Height" Value="42"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#007ACC"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Foreground" Value="#007ACC"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style for Buttons -->
        <Style x:Key="ModernButtonStyle" TargetType="Button">
            <Setter Property="Height" Value="42"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.85"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Border Name="DialogShell" Padding="32" Background="#FAFAFA" Opacity="1" RenderTransformOrigin="0.5,0.5">
            <Border.RenderTransform>
                <ScaleTransform ScaleX="1" ScaleY="1"/>
            </Border.RenderTransform>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="1">
                <!-- Password Input with Show/Hide Toggle -->
                <Grid Name="PasswordContainer" Margin="0,0,0,16">
                    <Grid.RenderTransform>
                        <TranslateTransform X="0"/>
                    </Grid.RenderTransform>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Password Box (initially visible) -->
                    <PasswordBox Name="PasswordBox" Grid.Column="0" Style="{StaticResource ModernPasswordBoxStyle}" PasswordChanged="PasswordInput_Changed" GotFocus="PasswordInput_FocusChanged" LostFocus="PasswordInput_FocusChanged" TabIndex="0"/>
                    
                    <!-- Password Text Box (hidden by default) -->
                    <TextBox Name="PasswordTextBox" Grid.Column="0" Style="{StaticResource ModernTextBoxStyle}" Visibility="Collapsed" TextChanged="PasswordInput_Changed" GotFocus="PasswordInput_FocusChanged" LostFocus="PasswordInput_FocusChanged" TabIndex="0"/>

                    <TextBlock Name="PasswordPlaceholder" Grid.Column="0" Margin="14,0,0,0" VerticalAlignment="Center" Foreground="#8A8A8A" FontSize="14" IsHitTestVisible="False" Text="Enter your password"/>
                    
                    <!-- Eye Icon Toggle Button -->
                        <Button Name="TogglePasswordVisibility" Grid.Column="1" Style="{StaticResource EyeButtonStyle}" Content="ðŸ‘"
                            PreviewMouseLeftButtonDown="RevealPasswordButton_PreviewMouseLeftButtonDown"
                            PreviewMouseLeftButtonUp="RevealPasswordButton_PreviewMouseLeftButtonUp"
                            MouseLeave="RevealPasswordButton_MouseLeave"
                            LostMouseCapture="RevealPasswordButton_LostMouseCapture"
                            PreviewTouchDown="RevealPasswordButton_PreviewTouchDown"
                            PreviewTouchUp="RevealPasswordButton_PreviewTouchUp"
                            IsTabStop="False"
                            ToolTip="Press and hold to reveal password"/>

                        <Button Name="InlineSubmitBtn" Grid.Column="2" Style="{StaticResource EyeButtonStyle}" Content="âžœ"
                            Click="ContinueBtn_Click"
                            IsDefault="True"
                            TabIndex="1"
                            ToolTip="Submit"/>
                </Grid>

                <TextBlock Name="VerifyErrorText" Visibility="Collapsed" Foreground="#A4262C" FontSize="12" Margin="0,-10,0,12" TextWrapping="Wrap"/>

                <!-- Confirm Password Panel (for setup mode) -->
                <StackPanel Name="ConfirmPanel" Visibility="Collapsed" Margin="0,0,0,16">
                    <TextBlock Text="Confirm Password:" Foreground="#1A1A1A" FontSize="12" Margin="0,0,0,6" FontWeight="SemiBold"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <PasswordBox Name="ConfirmPasswordBox" Grid.Column="0" Style="{StaticResource ModernPasswordBoxStyle}" TabIndex="10"/>
                        <Button Name="ToggleConfirmVisibility" Grid.Column="1" Style="{StaticResource EyeButtonStyle}" Content="ðŸ‘"
                            PreviewMouseLeftButtonDown="RevealConfirmButton_PreviewMouseLeftButtonDown"
                            PreviewMouseLeftButtonUp="RevealConfirmButton_PreviewMouseLeftButtonUp"
                            MouseLeave="RevealConfirmButton_MouseLeave"
                            LostMouseCapture="RevealConfirmButton_LostMouseCapture"
                            PreviewTouchDown="RevealConfirmButton_PreviewTouchDown"
                            PreviewTouchUp="RevealConfirmButton_PreviewTouchUp"
                            IsTabStop="False"
                            ToolTip="Press and hold to reveal password"/>
                    </Grid>
                    <TextBox Name="ConfirmPasswordTextBox" Style="{StaticResource ModernTextBoxStyle}" Visibility="Collapsed" Margin="0,0,0,0" TabIndex="10"/>
                </StackPanel>

                <TextBlock Name="HintText" Foreground="#666" FontSize="12" Margin="0,0,0,24"/>

                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
